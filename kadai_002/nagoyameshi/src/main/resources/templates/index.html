<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
   <head>
	<div th:replace="~{fragment :: meta}"></div>
	<div th:replace="~{fragment :: styles}"></div>
       <title>NAGOYAMESHI</title>	
   </head>
   <body>
        <div class="nagoyameshi-wrapper">
			<div th:replace="~{fragment :: header}"></div>
			
			<main>
				<div th:replace="~{fragment :: main-visual}"></div>
			    <div class="container pt-4 pb-5 nagoyameshi-container">
			        <div th:if="${param.loggedIn}" class="alert alert-info">
			            ログインしました。
			        </div>

			        <div th:if="${param.loggedOut}" class="alert alert-info">
			            ログアウトしました。
			        </div>

					<div th:if="${successMessage}" class="alert alert-info">
					    <span th:text="${successMessage}"></span>
					</div>  
					
				<div class="d-flex justify-content-center">
                        <form method="get" th:action="@{/shops}" class="mb-5 nagoyameshi-search-form">
                            <div class="input-group">
                                <input type="text" class="form-control" name="keyword" th:value="${keyword}" placeholder="店舗名・キーワード">
                                <button type="submit" class="btn shadow-sm nagoyameshi-btn">検索</button>
                            </div>
                        </form>
                    </div>

					<h2 class="text-center mb-3">新着店舗</h2>

					<div class="position-relative mb-5">
					  <button id="scrollLeft" class="scroll-button left">＜</button>
					  <button id="scrollRight" class="scroll-button right">＞</button>

					  <div class="horizontal-scroll-wrapper new-shops-wrapper">
					    <div class="scroll-container d-flex">
					      <div class="card me-3" th:each="newShop : ${newShops}" style="min-width: 200px;">
							
							  <a th:href="@{'/shops/' + ${newShop.id}}" class="link-dark nagoyameshi-card-link">
							    <img th:if="${newShop.imageName}" th:src="@{/storage/__${newShop.imageName}__}" class="card-img-top nagoyameshi-vertical-card-image" alt="店舗画像">
							    <img th:unless="${newShop.imageName}" th:src="@{/images/noImage.png}" class="card-img-top nagoyameshi-vertical-card-image" alt="NO IMAGE">
							    <div class="card-body">
							      <h3 class="card-title" th:text="${newShop.name}"></h3>
							      <p class="card-text mb-1">
							        <small class="text-muted" th:text="${newShop.address}"></small>
							      </p>
							    </div>
							  </a>
							</div>
					    </div>
					  </div>
					</div>

					<!--カテゴリ一覧-->
							<div class="category-container">
								<h2 class="text-center mb-3">カテゴリ一覧</h2>
							  <!-- 画像付きカテゴリ -->
							  <div class="category-image-list">
							    <a class="category-image-item" th:each="category : ${categories}"
							       th:if="${category.imageFileName != null}"
							       th:href="@{/shops(category=${category.name})}">

							      <img th:src="@{'/images/' + ${category.imageFileName}}"
							           alt="" class="category-image">

							      <div class="category-label" th:text="${category.name}"></div>
							    </a>
							  </div>

							  <!-- テキストのみカテゴリ -->
							  <div class="category-text-list mb-5">
							    <a class="category-text-pill"
							       th:each="category : ${categories}" 
							       th:if="${!imageCategoryNames.contains(category.name)}"
							       th:href="@{'/shops?category=' + ${category.name}}">
							       <i class="bi bi-tag me-1"></i><span th:text="${category.name}"></span>
							    </a>
							  </div>
							  
							</div>
							
							<!--評価高い順一覧-->
							<h2 class="text-center mb-3">評価が高い店舗</h2>

							<div class="position-relative mb-5">
							  <button id="rankingScrollLeft" class="scroll-button left">＜</button>
							  <button id="rankingScrollRight" class="scroll-button right">＞</button>

							  <div class="horizontal-scroll-wrapper ranking-shops-wrapper">
							    <div class="scroll-container d-flex">
							      <div class="card me-3" th:each="shop : ${rankingShops}" style="min-width: 200px;">
									
							        <a th:href="@{'/shops/' + ${shop.id}}" class="link-dark nagoyameshi-card-link">
							          <img th:if="${shop.imageName}" th:src="@{/storage/__${shop.imageName}__}" class="card-img-top nagoyameshi-vertical-card-image" alt="店舗画像">
							          <img th:unless="${shop.imageName}" th:src="@{/images/noImage.png}" class="card-img-top nagoyameshi-vertical-card-image" alt="NO IMAGE">
							          <div class="card-body">
							            <h3 class="card-title" th:text="${shop.name}"></h3>
							            <p class="card-text mb-1">
							              <small class="text-muted" th:text="${shop.address}"></small>
							            </p>
							            <!-- 平均評価の表示 -->
							            <p class="mb-0">
											<!-- 数値で平均評価を表示（例：4.33） -->
											<span th:text="${#numbers.formatDecimal(shop.averageRating, 1, 'COMMA', 2, 'POINT')}"></span>

											<!-- 星マークで平均評価を表示 -->
											<span class="nagoyameshi-star">
											    <span th:each="i : ${#numbers.sequence(1, 5)}"
											          th:utext="${i <= shop.roundedAverageRating} ? '&#9733;' : '&#9734;'">
											    </span>
											</span>

											<!-- 件数表示 -->
											<span th:text="${'（' + shop.reviews.size() + '件）'}"></span>
							            </p>
							          </div>
							        </a>
							      </div>
							    </div>
							  </div>
							</div>

						             
	                </div>
	            </main>
			
			<div th:replace="~{fragment :: footer}"></div>
		</div>
			<div th:replace="~{fragment :: scripts}"></div>
   </body>
</html>